{
    "version": "0.14.3.92",
    "description": "Rime Input Method Engine, maintained by fxliang.",
    "homepage": "https://github.com/fxliang/weasel",
    "license": {
        "identifier": "GPL-3.0-or-later",
        "url": "https://github.com/fxliang/weasel/raw/master/LICENSE.txt"
    },
    "depends": "autohotkey",
    "url": "https://github.com/fxliang/weasel/releases/download/0.14.3_dev_0.92/weasel-0.14.3.92-installer.exe#/installer.exe",
    "hash": "326dc97cb610ba4f50d8fb7334f4fc38a458f18c51db1f8cf835f666a4e947e0",
    "pre_install": [
        "if (Test-Path \"$env:AppData\\Rime\") {",
        "    info '[Persistent data]: Copying user data...'",
        "    ensure \"$persist_dir\\appdata\" | Out-Null",
        "    Copy-Item \"$env:AppData\\Rime\\*\" \"$persist_dir\\appdata\\\" -ErrorAction SilentlyContinue -Recurse -Force",
        "    Remove-Item \"$env:AppData\\Rime\" -ErrorAction SilentlyContinue -Recurse -Force",
        "}",
        "ensure \"$persist_dir\\appdata\" | Out-Null",
        "New-Item \"$env:AppData\\Rime\" -ItemType Junction -Target \"$persist_dir\\appdata\" | Out-Null"
    ],
    "installer": {
        "script": [
            "Start-Process \"$dir\\installer.exe\" -ArgumentList \"/S /D=$dir\" -WorkingDirectory \"$dir\"",
            "Start-Sleep -s 8",
            "# https://github.com/chtof/chocolatey-packages/blob/master/automatic/weasel/tools/chocolateyinstall.ahk",
            "Copy-Item \"$bucketsdir\\tian\\scripts\\weasel\\install.ahk\" \"$dir\\install.ahk\" -ErrorAction 'SilentlyContinue' -Force | Out-Null",
            "Start-Process \"autohotkey\" -Verb runas -ArgumentList \"`\"$dir\\install.ahk`\"\""
        ]
    },
    "post_install": [
        "if (Test-Path \"$persist_dir\\data\") { Copy-Item \"$persist_dir\\data\\*\" \"$dir\\weasel-$version\\data\" -ErrorAction 'SilentlyContinue' -Force -Recurse }",
        "Start-Sleep -s 8",
        "$weasel_startmenu_folder = [System.IO.Path]::Combine([Environment]::GetFolderPath('CommonStartMenu'), 'Programs', '小狼毫輸入法')",
        "if ($global) { $startmenu = 'CommonStartMenu' } else { $startmenu = 'StartMenu' }",
        "$scoop_startmenu_folder = [System.IO.Path]::Combine([Environment]::GetFolderPath($startmenu), 'Programs', 'Scoop Apps')",
        "Move-Item \"$weasel_startmenu_folder\" \"$scoop_startmenu_folder\\\" -ErrorAction 'SilentlyContinue' -Force",
        "Remove-Item \"$dir\\installer.exe\""
    ],
    "uninstaller": {
        "script": [
            "ensure \"$persist_dir\\data\" | Out-Null",
            "Copy-Item \"$dir\\weasel-$version\\data\\*\" \"$persist_dir\\data\" -Force -Recurse",
            "Start-Process \"$dir\\weasel-$version\\uninstall.exe\" -ArgumentList '/S' -Wait",
            "if ($global) { $startmenu = 'CommonStartMenu' } else { $startmenu = 'StartMenu' }",
            "$scoop_startmenu_folder = [System.IO.Path]::Combine([Environment]::GetFolderPath($startmenu), 'Programs', 'Scoop Apps')",
            "Remove-Item \"$scoop_startmenu_folder\\小狼毫輸入法\" -ErrorAction SilentlyContinue -Force -Recurse",
            "Remove-Item \"$env:APPDATA\\Rime\" -ErrorAction 'SilentlyContinue' -Force -Recurse"
        ]
    },
    "checkver": {
        "url": "https://api.github.com/repos/fxliang/weasel/releases",
        "regex": "(?<sm>)weasel-([\\d.]+)-installer.exe.*?releases/download/(?<tag>([\\w.]+))"
    },
    "autoupdate": {
        "url": "https://github.com/fxliang/weasel/releases/download/$matchTag/weasel-$version-installer.exe#/installer.exe"
    }
}
